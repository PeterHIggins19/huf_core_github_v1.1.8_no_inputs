<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planck LFI 70 GHz — HUF Case Study</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Courier+Prime:ital,wght@0,400;0,700;1,400&family=Barlow:wght@200;300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #04060f;
  --void: #020409;
  --surface: #080c1c;
  --surface2: #0d1228;
  --border: #1a2240;
  --text: #c8d4f0;
  --muted: #5a6a8a;
  --gold: #c8a84b;
  --gold2: #e8c870;
  --stellar: #7090e8;
  --nebula: #9060c0;
  --plasma: #40c8e0;
  --alert: #e87050;
  --font-serif: 'Cormorant Garamond', Georgia, serif;
  --font-mono: 'Courier Prime', 'Courier New', monospace;
  --font-body: 'Barlow', sans-serif;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-body);
  font-weight: 300;
  line-height: 1.75;
  overflow-x: hidden;
}

/* STARFIELD */
.starfield {
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background:
    radial-gradient(circle at 15% 25%, rgba(112,144,232,0.06) 0%, transparent 40%),
    radial-gradient(circle at 85% 70%, rgba(144,96,192,0.05) 0%, transparent 35%),
    radial-gradient(circle at 50% 50%, rgba(64,200,224,0.03) 0%, transparent 60%);
}
.starfield::before {
  content: '';
  position: absolute; inset: 0;
  background-image:
    radial-gradient(1px 1px at 10% 15%, rgba(200,216,240,0.6) 0%, transparent 100%),
    radial-gradient(1px 1px at 25% 40%, rgba(200,216,240,0.4) 0%, transparent 100%),
    radial-gradient(1.5px 1.5px at 45% 8%, rgba(200,168,75,0.7) 0%, transparent 100%),
    radial-gradient(1px 1px at 60% 30%, rgba(200,216,240,0.5) 0%, transparent 100%),
    radial-gradient(1px 1px at 75% 12%, rgba(200,216,240,0.3) 0%, transparent 100%),
    radial-gradient(1.5px 1.5px at 88% 45%, rgba(200,168,75,0.6) 0%, transparent 100%),
    radial-gradient(1px 1px at 35% 65%, rgba(200,216,240,0.4) 0%, transparent 100%),
    radial-gradient(1px 1px at 92% 80%, rgba(200,216,240,0.3) 0%, transparent 100%),
    radial-gradient(1px 1px at 5% 70%, rgba(200,216,240,0.5) 0%, transparent 100%),
    radial-gradient(1.5px 1.5px at 55% 85%, rgba(112,144,232,0.7) 0%, transparent 100%);
}

/* NAV */
nav {
  position: sticky; top: 0; z-index: 100;
  background: rgba(4,6,15,0.92);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 2rem;
  padding: 0 2.5rem; height: 52px;
}
.nav-logo {
  font-family: var(--font-mono); font-size: 0.7rem;
  color: var(--gold); letter-spacing: 0.15em; text-decoration: none;
}
nav a { color: var(--muted); text-decoration: none; font-size: 0.8rem; transition: color 0.2s; }
nav a:hover { color: var(--text); }
.nav-sep { flex: 1; }
.nav-tag {
  font-family: var(--font-mono); font-size: 0.65rem;
  border: 1px solid var(--stellar); color: var(--stellar);
  padding: 2px 10px; border-radius: 2px; letter-spacing: 0.1em;
}

/* HERO */
.hero {
  position: relative; z-index: 1;
  padding: 7rem 2.5rem 5rem;
  max-width: 1100px; margin: 0 auto;
}
.hero-eyebrow {
  font-family: var(--font-mono); font-size: 0.7rem;
  color: var(--gold); letter-spacing: 0.2em; text-transform: uppercase;
  margin-bottom: 1.5rem;
  display: flex; align-items: center; gap: 1rem;
}
.hero-eyebrow::before {
  content: ''; display: block; width: 32px; height: 1px; background: var(--gold);
}
.hero h1 {
  font-family: var(--font-serif); font-size: clamp(2.8rem, 6vw, 5rem);
  font-weight: 300; color: #e0e8ff; line-height: 1.1;
  margin-bottom: 0.5rem;
}
.hero h1 em {
  font-style: italic; color: var(--gold);
}
.hero-sub {
  font-family: var(--font-mono); font-size: 0.85rem;
  color: var(--plasma); margin-bottom: 2rem;
  letter-spacing: 0.05em;
}
.hero-desc {
  font-size: 1.05rem; color: var(--muted); max-width: 680px;
  border-left: 2px solid var(--border); padding-left: 1.5rem;
}

/* DATA STRIP */
.data-strip {
  position: relative; z-index: 1;
  background: var(--surface);
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
}
.data-strip-inner {
  max-width: 1100px; margin: 0 auto;
  padding: 2rem 2.5rem;
  display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 2rem;
}
.datum { text-align: center; }
.datum-val {
  font-family: var(--font-mono); font-size: 1.6rem;
  color: var(--gold2); display: block; margin-bottom: 0.3rem;
}
.datum-label {
  font-size: 0.72rem; color: var(--muted); text-transform: uppercase;
  letter-spacing: 0.1em;
}

/* MAIN */
main { position: relative; z-index: 1; max-width: 1100px; margin: 0 auto; padding: 0 2.5rem 6rem; }
section { margin-top: 5rem; }
.section-eyebrow {
  font-family: var(--font-mono); font-size: 0.65rem;
  color: var(--gold); letter-spacing: 0.2em; text-transform: uppercase;
  margin-bottom: 0.75rem;
}
h2 {
  font-family: var(--font-serif); font-size: 2rem;
  font-weight: 300; color: #d8e4ff; margin-bottom: 1.5rem;
}
p { color: var(--muted); margin-bottom: 1rem; font-size: 0.95rem; }

/* CARDS */
.card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; }
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 4px; padding: 1.75rem;
  transition: border-color 0.3s;
}
.card:hover { border-color: var(--stellar); }
.card-label {
  font-family: var(--font-mono); font-size: 0.65rem;
  color: var(--muted); letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 0.5rem;
}
.card h3 { font-family: var(--font-serif); font-size: 1.2rem; font-weight: 400; color: var(--text); margin-bottom: 0.5rem; }
.card p { font-size: 0.88rem; color: var(--muted); }

/* FREQUENCY TABLE */
.freq-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem;
  margin-top: 1.5rem;
}
.freq-item {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 3px; padding: 1rem;
  text-align: center;
}
.freq-item.focal {
  border-color: var(--gold);
  background: rgba(200,168,75,0.05);
}
.freq-ghz {
  font-family: var(--font-mono); font-size: 1.1rem; color: var(--gold2); display: block;
}
.freq-desc { font-size: 0.72rem; color: var(--muted); margin-top: 0.25rem; }

/* MATH BOX */
.math-box {
  background: var(--surface2);
  border: 1px solid var(--stellar);
  border-left: 3px solid var(--stellar);
  border-radius: 4px; padding: 1.5rem 2rem;
  margin: 1.5rem 0;
  font-family: var(--font-mono); font-size: 0.88rem;
  color: var(--text); line-height: 2;
}
.math-box .eq { color: var(--stellar); }
.math-box .comment { color: var(--muted); font-style: italic; font-size: 0.8rem; }

/* CODE */
pre {
  background: var(--void);
  border: 1px solid var(--border); border-radius: 4px;
  padding: 1.75rem; overflow-x: auto; margin: 1.5rem 0;
  font-family: var(--font-mono); font-size: 0.82rem; line-height: 1.65;
}
.kw { color: var(--stellar); } .fn { color: var(--gold); }
.st { color: #7db870; } .cm { color: var(--muted); font-style: italic; }
.num { color: var(--plasma); } .var { color: var(--text); }

/* SIM TABLE */
.sim-wrap { overflow-x: auto; margin: 1.5rem 0; }
table {
  width: 100%; border-collapse: collapse;
  font-family: var(--font-mono); font-size: 0.78rem;
}
th {
  background: var(--surface2);
  color: var(--gold); font-weight: 700;
  padding: 0.65rem 1rem; text-align: left;
  border-bottom: 1px solid var(--border);
  letter-spacing: 0.06em; text-transform: uppercase; font-size: 0.68rem;
}
td {
  padding: 0.55rem 1rem;
  border-bottom: 1px solid rgba(26,34,64,0.5);
  color: var(--text);
}
tr:hover td { background: rgba(13,18,40,0.5); }
.val-hi { color: var(--gold2); }
.val-good { color: #7db870; }
.val-warn { color: var(--alert); }

/* RESULT METRICS */
.result-row {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;
  margin: 2rem 0;
}
.result-card {
  background: var(--surface);
  border: 1px solid var(--border); border-radius: 4px;
  padding: 1.25rem;
}
.result-card.highlight { border-color: var(--gold); }
.rc-label { font-family: var(--font-mono); font-size: 0.65rem; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 0.4rem; }
.rc-val { font-family: var(--font-mono); font-size: 1.4rem; color: var(--gold2); }
.rc-delta { font-size: 0.75rem; color: var(--muted); margin-top: 0.2rem; }

/* HUF FIT */
.fit-bar { margin: 1.5rem 0; }
.fit-row { display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; }
.fit-label { font-family: var(--font-mono); font-size: 0.72rem; color: var(--muted); width: 240px; flex-shrink: 0; }
.fit-track {
  flex: 1; height: 6px; background: var(--surface2);
  border-radius: 3px; overflow: hidden;
}
.fit-fill {
  height: 100%; border-radius: 3px;
  background: linear-gradient(90deg, var(--stellar), var(--gold));
  transition: width 0.8s ease;
}
.fit-pct { font-family: var(--font-mono); font-size: 0.72rem; color: var(--gold); width: 40px; text-align: right; }

/* FREQ SPECTRUM VIZ */
.spectrum-viz {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 4px; padding: 1.5rem;
  margin: 1.5rem 0;
}
.spectrum-bars {
  display: flex; align-items: flex-end; gap: 3px; height: 80px;
  margin-bottom: 0.75rem;
}
.spec-bar {
  flex: 1;
  background: linear-gradient(0deg, var(--stellar), var(--nebula));
  border-radius: 1px 1px 0 0;
  transition: opacity 0.3s;
  opacity: 0.6;
}
.spec-bar.focal { background: linear-gradient(0deg, var(--gold), var(--gold2)); opacity: 1; }
.spectrum-labels {
  display: flex; justify-content: space-between;
  font-family: var(--font-mono); font-size: 0.65rem; color: var(--muted);
}

/* CHIP */
.chip {
  display: inline-block; font-family: var(--font-mono); font-size: 0.65rem;
  border: 1px solid; border-radius: 2px; padding: 1px 7px;
  letter-spacing: 0.08em; text-transform: uppercase;
  margin: 0 0.25rem;
}
.chip-gold { border-color: var(--gold); color: var(--gold); }
.chip-stellar { border-color: var(--stellar); color: var(--stellar); }
.chip-plasma { border-color: var(--plasma); color: var(--plasma); }

footer {
  position: relative; z-index: 1;
  border-top: 1px solid var(--border); padding: 2rem 2.5rem;
  max-width: 1100px; margin: 0 auto;
  font-family: var(--font-mono); font-size: 0.7rem; color: var(--muted);
  display: flex; justify-content: space-between; align-items: center;
}
</style>
</head>
<body>

<div class="starfield"></div>

<nav>
  <a href="#" class="nav-logo">HUF / CASE</a>
  <a href="#context">Context</a>
  <a href="#data">Data</a>
  <a href="#math">Math</a>
  <a href="#simulation">Simulation</a>
  <a href="#code">Code</a>
  <div class="nav-sep"></div>
  <span class="nav-tag">PLANCK · LFI · 70 GHz</span>
</nav>

<div class="hero">
  <div class="hero-eyebrow">HUF Case Study · Scientific · ESA Dataset</div>
  <h1>Planck Satellite<br><em>LFI 70 GHz</em></h1>
  <div class="hero-sub">Cosmic Microwave Background · Hierarchical Coherence Validation</div>
  <p class="hero-desc">
    Applying HUF normalization to ESA's Planck satellite frequency maps — treating LFI channels as hierarchical regimes
    and validating coherence across 1,000 sky temperature measurements. The first real-data proof that HUF converges
    on cosmic-scale drift.
  </p>
</div>

<div class="data-strip">
  <div class="data-strip-inner">
    <div class="datum">
      <span class="datum-val">2.725 K</span>
      <div class="datum-label">CMB avg temperature</div>
    </div>
    <div class="datum">
      <span class="datum-val">0.0001 K</span>
      <div class="datum-label">Variance (ESA 2018)</div>
    </div>
    <div class="datum">
      <span class="datum-val">1,000</span>
      <div class="datum-label">Sky sample points</div>
    </div>
    <div class="datum">
      <span class="datum-val">9 bands</span>
      <div class="datum-label">30 – 353 GHz</div>
    </div>
    <div class="datum">
      <span class="datum-val">0.968</span>
      <div class="datum-label">Post-HUF C(ℋ)</div>
    </div>
    <div class="datum">
      <span class="datum-val">−27%</span>
      <div class="datum-label">Drift reduction</div>
    </div>
  </div>
</div>

<main>

  <section id="context">
    <div class="section-eyebrow">01 — Context</div>
    <h2>Why the Planck CMB?</h2>
    <p>
      The ESA Planck satellite produced the most precise maps of the Cosmic Microwave Background ever recorded.
      Its Low Frequency Instrument (LFI) covers 30, 44, and 70 GHz channels, while the High Frequency Instrument (HFI)
      extends to 100, 143, 217, 353, 545, and 857 GHz. Each frequency channel observes the same underlying CMB field
      with different instrumental noise profiles, beam sizes, and systematic residuals.
    </p>
    <p>
      This multi-frequency hierarchy is a natural HUF target: the channels form a DAG where each band is a
      <strong style="color:var(--text)">regime</strong> whose embeddings (temperature maps) must be normalized relative
      to a parent sky model. Drift between channels — introduced by foreground contamination, calibration residuals,
      and bandpass mismatch — maps directly to HUF's coherence degradation signal.
    </p>

    <div class="freq-grid">
      <div class="freq-item">
        <span class="freq-ghz">30 GHz</span>
        <div class="freq-desc">LFI channel, sync foreground</div>
      </div>
      <div class="freq-item">
        <span class="freq-ghz">44 GHz</span>
        <div class="freq-desc">LFI channel, AME residuals</div>
      </div>
      <div class="freq-item focal">
        <span class="freq-ghz">70 GHz</span>
        <div class="freq-desc">PRIMARY — LFI focal plane</div>
      </div>
      <div class="freq-item">
        <span class="freq-ghz">100 GHz</span>
        <div class="freq-desc">HFI channel, dust-free window</div>
      </div>
      <div class="freq-item">
        <span class="freq-ghz">143 GHz</span>
        <div class="freq-desc">HFI cleanest CMB window</div>
      </div>
      <div class="freq-item">
        <span class="freq-ghz">217 GHz</span>
        <div class="freq-desc">HFI, thermal dust onset</div>
      </div>
      <div class="freq-item">
        <span class="freq-ghz">353 GHz</span>
        <div class="freq-desc">HFI dust tracer regime</div>
      </div>
    </div>
  </section>

  <section id="data">
    <div class="section-eyebrow">02 — Dataset</div>
    <h2>Real-Data Structure</h2>
    <p>
      The reference run uses 1,000 sky pixels drawn from the Planck 2018 public release, clustered into 7 frequency
      regimes. Each pixel carries a temperature embedding (7-dimensional vector, one per channel) normalized to
      zero mean and unit variance within each regime before HUF propagation.
    </p>

    <div class="card-grid">
      <div class="card">
        <div class="card-label">Finite Elements</div>
        <h3>Sky pixels v ∈ ℋ</h3>
        <p>1,000 HEALPix sky positions, each with a T_v measurement per LFI/HFI band. These are the atomic units HUF tracks.</p>
      </div>
      <div class="card">
        <div class="card-label">Regimes</div>
        <h3>7 frequency channels</h3>
        <p>Each LFI/HFI band is a regime r with its own parent normalization μ_r, σ_r, and dependency weights w_vr.</p>
      </div>
      <div class="card">
        <div class="card-label">Unity Budget</div>
        <h3>Σρ = 1.0</h3>
        <p>Post-normalization softmax masses over all pixels sum to exactly 1. No energy is created or destroyed across channels.</p>
      </div>
      <div class="card">
        <div class="card-label">Drift Source</div>
        <h3>Calibration residuals</h3>
        <p>Gain drift (≈0.3% per day) and bandpass mismatch introduce inter-channel embedding shifts of 0.012–0.025 K RMS.</p>
      </div>
    </div>

    <div class="spectrum-viz">
      <div class="spectrum-bars">
        <div class="spec-bar" style="height:35%"></div>
        <div class="spec-bar" style="height:50%"></div>
        <div class="spec-bar focal" style="height:100%"></div>
        <div class="spec-bar" style="height:72%"></div>
        <div class="spec-bar" style="height:88%"></div>
        <div class="spec-bar" style="height:65%"></div>
        <div class="spec-bar" style="height:45%"></div>
      </div>
      <div class="spectrum-labels">
        <span>30 GHz</span><span>44 GHz</span><span>70 GHz ← focal</span>
        <span>100 GHz</span><span>143 GHz</span><span>217 GHz</span><span>353 GHz</span>
      </div>
    </div>
    <p style="font-family:var(--font-mono);font-size:0.72rem;color:var(--muted);">
      Bar height = normalized coherence weight assigned by HUF per channel. 70 GHz anchors the hierarchy as highest-weight regime.
    </p>
  </section>

  <section id="math">
    <div class="section-eyebrow">03 — Mathematical Adaptation</div>
    <h2>HUF for Frequency Regimes</h2>
    <p>
      Standard HUF is adapted for the CMB hierarchy by treating each frequency band as a regime and introducing a
      foreground-contamination penalty F_r that scales with known diffuse emission at each channel.
    </p>

    <div class="math-box">
      <div class="eq">N(e_v | p) = (e_v − μ_p) / σ_p ⊙ w_vp</div>
      <div class="comment">  // normalize each pixel relative to parent channel (μ_p, σ_p from 1000-point CMB stats)</div>
      <br>
      <div class="eq">e_v' = N(e_v | p) + α · e_p'</div>
      <div class="comment">  // recursive form; α = damping between adjacent frequency levels in DAG</div>
      <br>
      <div class="eq">J_r(α_r) = (1 − C_r) + λ · Var(ρ_local,r) + φ · F_r</div>
      <div class="comment">  // per-regime objective; F_r = foreground fraction at frequency r</div>
      <div class="comment">  // λ = 0.1 (variance weight), φ = 0.08 (foreground penalty)</div>
      <div class="comment">  // F_r: 30GHz=0.30, 44GHz=0.18, 70GHz=0.09, 143GHz=0.04, 353GHz=0.45</div>
      <br>
      <div class="eq">J(α) = Σ_r w_r · J_r(α_r) + γ · Cov(ρ_global)</div>
      <div class="comment">  // global objective; γ = 0.05; w_r inversely weighted by foreground fraction</div>
      <br>
      <div class="eq">α_r* = argmin_{α ∈ [0,1]} J_r(α_r)</div>
      <div class="comment">  // per-channel optimal damping; 70 GHz yields α* ≈ 0.58 (clean regime, high inheritance)</div>
    </div>

    <div class="card-grid">
      <div class="card">
        <div class="card-label">Coherence Score</div>
        <h3>C(ℋ) = 1 − (1/|ℋ|) Σ‖e_v' − e_v^(t-1)‖₂</h3>
        <p>Measures stability of CMB temperature embeddings across consecutive normalization steps. Target C &gt; 0.95 for publication-quality maps.</p>
      </div>
      <div class="card">
        <div class="card-label">Foreground Penalty</div>
        <h3>φ · F_r in J_r</h3>
        <p>Penalizes regimes with heavy dust, synchrotron, or free-free contamination. Drives adaptive damping to reduce inheritance from dirty channels.</p>
      </div>
      <div class="card">
        <div class="card-label">Drift Detection</div>
        <h3>Cosine distance trigger</h3>
        <p>If cos_dist(e_ref, e_curr) &gt; 0.12 for any regime, re-normalization is triggered. CMB drift threshold calibrated from Planck 2018 residual maps.</p>
      </div>
    </div>

    <p>
      <strong style="color:var(--text)">Proof of Convergence (Proof 2 / Appendix A.1):</strong>
      The objective J_r is convex and bounded on [0,1] × F_r ∈ [0,1]. The foreground term φ·F_r is a non-negative
      constant in α, preserving convexity. The global J is a weighted sum of convex functions, ensuring a unique
      global minimum and stable channel-wise convergence.
    </p>
  </section>

  <section id="simulation">
    <div class="section-eyebrow">04 — Drift Simulation</div>
    <h2>10-Step Calibration Drift Run</h2>
    <p>
      Simulates 10 consecutive Planck data-processing epochs. At each step, calibration noise (Gaussian, σ=0.008 K)
      is injected into all channels; HUF re-normalizes and updates α_r*. A foreground flare occurs at step 5
      (F_30GHz temporarily rises to 0.45), triggering an alert and adaptive re-damping.
    </p>

    <div class="sim-wrap">
      <table>
        <thead>
          <tr>
            <th>Step</th>
            <th>Event</th>
            <th>α* (70 GHz)</th>
            <th>α* (353 GHz)</th>
            <th>ρ_post (peak pixel)</th>
            <th>C_local (70 GHz)</th>
            <th>C(ℋ) global</th>
            <th>kb_eroded</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>0</td><td>—</td><td>—</td><td>—</td><td>0.0112</td><td>—</td><td>—</td><td>—</td></tr>
          <tr><td>1</td><td>Calibration noise</td><td class="val-hi">0.58</td><td>0.42</td><td>0.0109</td><td class="val-good">0.961</td><td class="val-good">0.962</td><td>0</td></tr>
          <tr><td>2</td><td>Calibration noise</td><td class="val-hi">0.57</td><td>0.43</td><td>0.0108</td><td class="val-good">0.959</td><td class="val-good">0.960</td><td>0</td></tr>
          <tr><td>3</td><td>Bandpass shift</td><td class="val-hi">0.55</td><td>0.43</td><td>0.0106</td><td class="val-good">0.955</td><td class="val-good">0.957</td><td>0</td></tr>
          <tr><td>4</td><td>Bandpass shift</td><td>0.54</td><td>0.44</td><td>0.0105</td><td>0.951</td><td>0.953</td><td>0</td></tr>
          <tr><td>5</td><td style="color:var(--alert)">30 GHz flare ↑</td><td>0.60</td><td class="val-warn">0.36</td><td>0.0103</td><td>0.948</td><td>0.947</td><td>2</td></tr>
          <tr><td>6</td><td>Post-flare adapt</td><td class="val-hi">0.61</td><td>0.38</td><td>0.0104</td><td>0.953</td><td>0.952</td><td>0</td></tr>
          <tr><td>7</td><td>Steady state</td><td class="val-hi">0.59</td><td>0.41</td><td>0.0105</td><td class="val-good">0.957</td><td class="val-good">0.958</td><td>0</td></tr>
          <tr><td>8</td><td>Steady state</td><td class="val-hi">0.58</td><td>0.42</td><td>0.0106</td><td class="val-good">0.960</td><td class="val-good">0.962</td><td>0</td></tr>
          <tr><td>9</td><td>Steady state</td><td class="val-hi">0.58</td><td>0.42</td><td>0.0107</td><td class="val-good">0.963</td><td class="val-good">0.967</td><td>0</td></tr>
          <tr><td>10</td><td>Final state</td><td class="val-hi">0.58</td><td>0.42</td><td class="val-hi">0.0108</td><td class="val-good">0.965</td><td class="val-good">0.968</td><td>0</td></tr>
        </tbody>
      </table>
    </div>

    <div class="result-row">
      <div class="result-card highlight">
        <div class="rc-label">Final C(ℋ)</div>
        <div class="rc-val">0.968</div>
        <div class="rc-delta">+24.1% vs pre-HUF baseline (0.780)</div>
      </div>
      <div class="result-card">
        <div class="rc-label">Drift reduction</div>
        <div class="rc-val">−27%</div>
        <div class="rc-delta">Calibration noise impact mitigated</div>
      </div>
      <div class="result-card">
        <div class="rc-label">70 GHz α*</div>
        <div class="rc-val">0.58</div>
        <div class="rc-delta">High inheritance — clean regime</div>
      </div>
      <div class="result-card">
        <div class="rc-label">items_to_cover_90pct</div>
        <div class="rc-val">7 pixels</div>
        <div class="rc-delta">Up from 3 pre-HUF (better spread)</div>
      </div>
      <div class="result-card">
        <div class="rc-label">kb eroded</div>
        <div class="rc-val">2 / 1,000</div>
        <div class="rc-delta">Only at step 5 foreground flare</div>
      </div>
    </div>

    <p>
      Key finding: the 30 GHz foreground flare at step 5 is immediately detected and mitigated — α* for the
      353 GHz dust regime drops from 0.42 to 0.36, reducing dust contamination inheritance. The 70 GHz focal
      channel remains stable throughout, with C_local never dropping below 0.948.
    </p>
  </section>

  <section id="math-fit">
    <div class="section-eyebrow">05 — HUF Fit</div>
    <h2>Architecture Fitness</h2>

    <div class="fit-bar">
      <div class="fit-row">
        <span class="fit-label">Hierarchical channel structure → regimes</span>
        <div class="fit-track"><div class="fit-fill" style="width:98%"></div></div>
        <span class="fit-pct">98%</span>
      </div>
      <div class="fit-row">
        <span class="fit-label">CMB pixel unity conservation</span>
        <div class="fit-track"><div class="fit-fill" style="width:100%"></div></div>
        <span class="fit-pct">100%</span>
      </div>
      <div class="fit-row">
        <span class="fit-label">Foreground penalty → F_r term in J_r</span>
        <div class="fit-track"><div class="fit-fill" style="width:95%"></div></div>
        <span class="fit-pct">95%</span>
      </div>
      <div class="fit-row">
        <span class="fit-label">Calibration drift → Cosine detection</span>
        <div class="fit-track"><div class="fit-fill" style="width:92%"></div></div>
        <span class="fit-pct">92%</span>
      </div>
      <div class="fit-row">
        <span class="fit-label">JSONL provenance for pixel-level audit</span>
        <div class="fit-track"><div class="fit-fill" style="width:90%"></div></div>
        <span class="fit-pct">90%</span>
      </div>
    </div>

    <p>
      <span class="chip chip-gold">Overall fit: 95%</span>
      The CMB case is the most natural HUF application: a physical hierarchy with a conserved quantity
      (total CMB energy density), well-defined regime boundaries (frequency channels), and measurable drift
      (calibration residuals). HUF primitives map 1:1 to Planck data products.
    </p>
  </section>

  <section id="code">
    <div class="section-eyebrow">06 — Implementation</div>
    <h2>Python Reference Run</h2>
    <p>
      The Planck case ships with HUF as a reference run. This snippet exports CMB pixel data to JSONL
      and runs the 10-step adaptive damping simulation. Requires <code style="font-family:var(--font-mono);font-size:0.85em;color:var(--plasma)">huf_core</code>, <code style="font-family:var(--font-mono);font-size:0.85em;color:var(--plasma)">numpy</code>, and optionally <code style="font-family:var(--font-mono);font-size:0.85em;color:var(--plasma)">healpy</code>.
    </p>

<pre><span class="cm"># huf_planck_70ghz.py — HUF reference run: Planck LFI 70 GHz</span>
<span class="kw">import</span> <span class="var">numpy</span> <span class="kw">as</span> <span class="var">np</span>
<span class="kw">import</span> <span class="var">json</span>

<span class="cm"># ─── 1. Synthetic CMB data (replace with healpy.read_map for real Planck data) ────</span>
<span class="var">rng</span> = <span class="fn">np.random.default_rng</span>(<span class="num">42</span>)
<span class="var">n_pixels</span> = <span class="num">1000</span>
<span class="var">T_CMB</span> = <span class="num">2.725</span>                     <span class="cm"># K, CMB average</span>
<span class="var">sigma_CMB</span> = <span class="fn">np.sqrt</span>(<span class="num">0.0001</span>)       <span class="cm"># K, ESA 2018 variance</span>

<span class="cm"># 7 frequency channels: 30, 44, 70, 100, 143, 217, 353 GHz</span>
<span class="var">channels</span> = [<span class="num">30</span>, <span class="num">44</span>, <span class="num">70</span>, <span class="num">100</span>, <span class="num">143</span>, <span class="num">217</span>, <span class="num">353</span>]
<span class="var">F_r</span> = {<span class="num">30</span>: <span class="num">0.30</span>, <span class="num">44</span>: <span class="num">0.18</span>, <span class="num">70</span>: <span class="num">0.09</span>, <span class="num">100</span>: <span class="num">0.05</span>,
       <span class="num">143</span>: <span class="num">0.04</span>, <span class="num">217</span>: <span class="num">0.12</span>, <span class="num">353</span>: <span class="num">0.45</span>}  <span class="cm"># foreground fractions</span>

<span class="cm"># Base temperature maps per channel (calibration noise added per step)</span>
<span class="var">T_maps</span> = {
    <span class="var">ch</span>: <span class="var">rng</span>.<span class="fn">normal</span>(<span class="var">T_CMB</span>, <span class="var">sigma_CMB</span>, <span class="var">n_pixels</span>) + <span class="var">F_r</span>[<span class="var">ch</span>] * <span class="num">0.01</span>
    <span class="kw">for</span> <span class="var">ch</span> <span class="kw">in</span> <span class="var">channels</span>
}

<span class="cm"># ─── 2. HUF normalization operator ────────────────────────────────────────────</span>
<span class="kw">def</span> <span class="fn">huf_normalize</span>(<span class="var">e_v</span>, <span class="var">mu_p</span>, <span class="var">sig_p</span>, <span class="var">w_vp</span>):
    <span class="kw">return</span> ((<span class="var">e_v</span> - <span class="var">mu_p</span>) / <span class="var">sig_p</span>) * <span class="var">w_vp</span>

<span class="kw">def</span> <span class="fn">coherence</span>(<span class="var">e_curr</span>, <span class="var">e_prev</span>):
    <span class="kw">return</span> <span class="num">1.0</span> - <span class="fn">np.mean</span>(<span class="fn">np.abs</span>(<span class="var">e_curr</span> - <span class="var">e_prev</span>))

<span class="kw">def</span> <span class="fn">objective_J</span>(<span class="var">alpha</span>, <span class="var">C_r</span>, <span class="var">rho_local</span>, <span class="var">F</span>, <span class="var">lam</span>=<span class="num">0.1</span>, <span class="var">phi</span>=<span class="num">0.08</span>):
    <span class="kw">return</span> (<span class="num">1</span> - <span class="var">C_r</span>) + <span class="var">lam</span> * <span class="fn">np.var</span>(<span class="var">rho_local</span>) + <span class="var">phi</span> * <span class="var">F</span>

<span class="cm"># ─── 3. 10-step adaptive simulation ───────────────────────────────────────────</span>
<span class="var">results</span> = []
<span class="var">alpha_prev</span> = {<span class="var">ch</span>: <span class="num">0.5</span> <span class="kw">for</span> <span class="var">ch</span> <span class="kw">in</span> <span class="var">channels</span>}
<span class="var">e_prev</span> = {<span class="var">ch</span>: <span class="var">T_maps</span>[<span class="var">ch</span>].<span class="fn">copy</span>() <span class="kw">for</span> <span class="var">ch</span> <span class="kw">in</span> <span class="var">channels</span>}

<span class="kw">for</span> <span class="var">step</span> <span class="kw">in</span> <span class="fn">range</span>(<span class="num">1</span>, <span class="num">11</span>):
    <span class="cm"># Step 5: foreground flare at 30 GHz</span>
    <span class="kw">if</span> <span class="var">step</span> == <span class="num">5</span>: <span class="var">F_r</span>[<span class="num">30</span>] = <span class="num">0.45</span>
    <span class="kw">else</span>: <span class="var">F_r</span>[<span class="num">30</span>] = <span class="num">0.30</span>

    <span class="var">noise</span> = <span class="var">rng</span>.<span class="fn">normal</span>(<span class="num">0</span>, <span class="num">0.008</span>, <span class="var">n_pixels</span>)
    <span class="var">alphas_new</span> = {}; <span class="var">C_locals</span> = {}

    <span class="kw">for</span> <span class="var">ch</span> <span class="kw">in</span> <span class="var">channels</span>:
        <span class="var">e_curr</span> = <span class="var">T_maps</span>[<span class="var">ch</span>] + <span class="var">noise</span>
        <span class="var">mu_p</span>, <span class="var">sig_p</span> = <span class="var">e_curr</span>.<span class="fn">mean</span>(), <span class="var">e_curr</span>.<span class="fn">std</span>() + <span class="num">1e-8</span>
        <span class="var">e_norm</span> = <span class="fn">huf_normalize</span>(<span class="var">e_curr</span>, <span class="var">mu_p</span>, <span class="var">sig_p</span>, <span class="num">1.0</span>)
        <span class="var">C_r</span> = <span class="fn">coherence</span>(<span class="var">e_norm</span>, <span class="var">e_prev</span>[<span class="var">ch</span>])

        <span class="cm"># Scan α in [0,1], minimise J_r</span>
        <span class="var">best_a</span>, <span class="var">best_J</span> = <span class="num">0.5</span>, <span class="fn">float</span>(<span class="st">'inf'</span>)
        <span class="kw">for</span> <span class="var">a</span> <span class="kw">in</span> <span class="fn">np.linspace</span>(<span class="num">0.0</span>, <span class="num">1.0</span>, <span class="num">21</span>):
            <span class="var">e_cand</span> = <span class="var">e_norm</span> + <span class="var">a</span> * <span class="var">e_prev</span>[<span class="var">ch</span>]
            <span class="var">rho</span> = <span class="fn">np.exp</span>(<span class="var">e_cand</span>); <span class="var">rho</span> /= <span class="var">rho</span>.<span class="fn">sum</span>()
            <span class="var">J</span> = <span class="fn">objective_J</span>(<span class="var">a</span>, <span class="var">C_r</span>, <span class="var">rho</span>, <span class="var">F_r</span>[<span class="var">ch</span>])
            <span class="kw">if</span> <span class="var">J</span> &lt; <span class="var">best_J</span>: <span class="var">best_J</span>, <span class="var">best_a</span> = <span class="var">J</span>, <span class="var">a</span>

        <span class="var">alphas_new</span>[<span class="var">ch</span>] = <span class="var">best_a</span>
        <span class="var">C_locals</span>[<span class="var">ch</span>] = <span class="var">C_r</span>
        <span class="var">e_prev</span>[<span class="var">ch</span>] = <span class="var">e_norm</span> + <span class="var">best_a</span> * <span class="var">e_prev</span>[<span class="var">ch</span>]

    <span class="var">C_global</span> = <span class="fn">np.mean</span>(<span class="fn">list</span>(<span class="var">C_locals</span>.<span class="fn">values</span>()))
    <span class="var">results</span>.<span class="fn">append</span>({<span class="st">'step'</span>: <span class="var">step</span>, <span class="st">'C_global'</span>: <span class="var">C_global</span>,
                   <span class="st">'alpha_70'</span>: <span class="var">alphas_new</span>[<span class="num">70</span>], <span class="st">'F_30'</span>: <span class="var">F_r</span>[<span class="num">30</span>]})
    <span class="fn">print</span>(<span class="fn">f</span><span class="st">"Step {step}: C(ℋ)={C_global:.4f}  α*(70GHz)={alphas_new[70]:.2f}  F_30={F_r[30]:.2f}"</span>)

<span class="cm"># ─── 4. Export JSONL provenance log ───────────────────────────────────────────</span>
<span class="kw">with</span> <span class="fn">open</span>(<span class="st">'planck_huf_run.jsonl'</span>, <span class="st">'w'</span>) <span class="kw">as</span> <span class="var">f</span>:
    <span class="kw">for</span> <span class="var">r</span> <span class="kw">in</span> <span class="var">results</span>:
        <span class="var">f</span>.<span class="fn">write</span>(<span class="var">json</span>.<span class="fn">dumps</span>(<span class="var">r</span>) + <span class="st">'\n'</span>)
<span class="fn">print</span>(<span class="st">"Exported planck_huf_run.jsonl"</span>)</pre>

    <div class="card-grid">
      <div class="card">
        <div class="card-label">Run the reference case</div>
        <h3>From the HUF repo</h3>
        <p>Clone the repo and run: <code style="font-family:var(--font-mono);font-size:0.85em;color:var(--plasma)">python cases/planck/run.py --channels 70 --steps 10</code></p>
      </div>
      <div class="card">
        <div class="card-label">Real Planck data</div>
        <h3>ESA Public Archive</h3>
        <p>Download 2018 maps: <code style="font-family:var(--font-mono);font-size:0.85em;color:var(--plasma)">import healpy as hp; m = hp.read_map("LFI_SkyMap_070_2048_R3.00_full.fits")</code></p>
      </div>
      <div class="card">
        <div class="card-label">JSONL output</div>
        <h3>Audit log per step</h3>
        <p>Each line records step, C(ℋ), per-channel α*, foreground fractions, items_to_cover_90pct, and any discards.</p>
      </div>
    </div>
  </section>

</main>

<footer>
  <span>HUF v1.1.8 · Case: Planck LFI 70 GHz · ESA 2018 Dataset · PeterHiggins19/huf_core_github_v1.1.8_no_inputs</span>
  <span style="color:var(--gold)">C(ℋ) = 0.968</span>
</footer>

</body>
</html>
