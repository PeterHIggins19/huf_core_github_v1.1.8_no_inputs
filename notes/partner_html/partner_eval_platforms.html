<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eval Platforms × HUF — Composition Audit</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@200;400;600&family=Fira+Code:wght@400;600&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f4f2ee;
  --surface: #eceae5;
  --surface2: #e4e1da;
  --border: #d0ccc3;
  --text: #1a1814;
  --muted: #7a7268;
  --accent: #2b5ba8;
  --accent2: #c94f1e;
  --accent3: #3a8c4e;
  --font-display: 'Sora', sans-serif;
  --font-mono: 'Fira Code', monospace;
  --font-body: 'Lora', serif;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-body);
  font-weight: 400;
  line-height: 1.75;
}

nav {
  position: sticky; top: 0; z-index: 100;
  background: rgba(244,242,238,0.96);
  backdrop-filter: blur(8px);
  border-bottom: 2px solid var(--text);
  display: flex; align-items: center; gap: 2rem;
  padding: 0 2rem; height: 54px;
}
.nav-logo {
  font-family: var(--font-display);
  font-weight: 600;
  font-size: 1rem;
  color: var(--text);
  text-decoration: none;
  letter-spacing: -0.02em;
}
nav a { color: var(--muted); text-decoration: none; font-family: var(--font-display); font-size: 0.82rem; font-weight: 400; transition: color 0.2s; }
nav a:hover { color: var(--text); }
.nav-sep { flex: 1; }
.nav-tag {
  font-family: var(--font-mono);
  font-size: 0.68rem;
  background: var(--text);
  color: var(--bg);
  padding: 3px 10px;
  border-radius: 2px;
}

.hero {
  padding: 7rem 4rem 5rem;
  border-bottom: 1px solid var(--border);
  display: grid;
  grid-template-columns: 1fr 380px;
  gap: 4rem;
  align-items: start;
}
.hero-left {}
.hero-eyebrow {
  font-family: var(--font-display);
  font-size: 0.72rem;
  font-weight: 400;
  color: var(--muted);
  letter-spacing: 0.15em;
  text-transform: uppercase;
  margin-bottom: 1.5rem;
}
.hero h1 {
  font-family: var(--font-display);
  font-weight: 200;
  font-size: clamp(2.5rem, 6vw, 4.5rem);
  line-height: 1.1;
  letter-spacing: -0.03em;
  margin-bottom: 1.5rem;
}
.hero h1 strong { font-weight: 600; }
.hero-sub {
  font-size: 1.05rem;
  color: var(--muted);
  max-width: 520px;
  line-height: 1.8;
}
.hero-aside {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 2rem;
  margin-top: 2rem;
}
.aside-title {
  font-family: var(--font-display);
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 1.5rem;
}
.aside-metric {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.7rem 0;
  border-bottom: 1px solid var(--border);
  font-family: var(--font-display);
  font-size: 0.85rem;
}
.aside-metric:last-child { border-bottom: none; }
.aside-metric .label { color: var(--muted); font-weight: 400; }
.aside-metric .val { font-weight: 600; color: var(--accent); font-family: var(--font-mono); }

/* PLATFORMS TABLE */
.platforms-section {
  padding: 5rem 4rem;
  border-bottom: 1px solid var(--border);
}
.sec-header {
  display: flex; align-items: baseline; gap: 1.5rem;
  margin-bottom: 3rem;
  border-bottom: 1px solid var(--border);
  padding-bottom: 1.5rem;
}
.sec-num {
  font-family: var(--font-mono);
  font-size: 0.68rem;
  color: var(--muted);
}
.sec-title {
  font-family: var(--font-display);
  font-weight: 600;
  font-size: 1.5rem;
  letter-spacing: -0.02em;
}
.platforms-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 1.5rem;
}
.plat-card {
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 1.5rem;
  background: white;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.plat-card:hover { border-color: var(--accent); box-shadow: 0 2px 12px rgba(43,91,168,0.1); }
.plat-name {
  font-family: var(--font-display);
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 0.5rem;
}
.plat-desc { font-size: 0.85rem; color: var(--muted); margin-bottom: 1rem; line-height: 1.6; }
.plat-hook {
  font-family: var(--font-mono);
  font-size: 0.72rem;
  color: var(--accent);
  background: rgba(43,91,168,0.06);
  border: 1px solid rgba(43,91,168,0.15);
  padding: 0.4rem 0.8rem;
  border-radius: 3px;
}

/* MATH */
.math-section {
  padding: 5rem 4rem;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
}
.math-row {
  display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;
  margin-bottom: 2rem;
}
.math-block {
  background: white;
  border: 1px solid var(--border);
  padding: 2rem;
  border-radius: 4px;
}
.math-block.full { grid-column: 1/-1; }
.math-label {
  font-family: var(--font-display);
  font-size: 0.68rem;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--accent);
  margin-bottom: 1rem;
}
.math-eq {
  font-family: var(--font-mono);
  font-size: 0.88rem;
  line-height: 2;
  background: var(--surface2);
  padding: 1rem;
  border-radius: 3px;
  overflow-x: auto;
}
.math-eq .hi { color: var(--accent); }
.math-eq .cm { color: var(--muted); }
.math-note {
  font-size: 0.83rem;
  color: var(--muted);
  margin-top: 0.8rem;
  font-family: var(--font-display);
  font-weight: 400;
}

/* CODE */
.code-section {
  padding: 5rem 4rem;
  border-bottom: 1px solid var(--border);
}
.code-wrap {
  background: var(--text);
  border-radius: 6px;
  overflow: hidden;
}
.code-header {
  display: flex; align-items: center; gap: 0.8rem;
  padding: 0.8rem 1.5rem;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  background: rgba(255,255,255,0.05);
}
.code-dot { width: 10px; height: 10px; border-radius: 50%; }
.code-filename {
  font-family: var(--font-mono);
  font-size: 0.72rem;
  color: rgba(255,255,255,0.4);
  margin-left: auto;
}
pre {
  padding: 2rem 1.5rem;
  font-family: var(--font-mono);
  font-size: 0.82rem;
  line-height: 1.9;
  overflow-x: auto;
  color: #d0ccc0;
  white-space: pre;
}
.kw { color: #82aaff; }
.st { color: #c3e88d; }
.cm { color: #546e7a; font-style: italic; }
.fn { color: #ffcb6b; }
.nu { color: #f78c6c; }

/* SIMULATION */
.sim-section {
  padding: 5rem 4rem;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
}
.sim-table {
  width: 100%;
  border-collapse: collapse;
  font-family: var(--font-display);
  font-size: 0.82rem;
  background: white;
}
.sim-table th {
  padding: 0.9rem 1rem;
  text-align: left;
  font-weight: 600;
  font-size: 0.72rem;
  letter-spacing: 0.07em;
  text-transform: uppercase;
  border-bottom: 2px solid var(--text);
  color: var(--muted);
}
.sim-table td {
  padding: 0.7rem 1rem;
  border-bottom: 1px solid var(--border);
}
.sim-table tr:hover td { background: rgba(43,91,168,0.03); }
.hi-alert { color: var(--accent2); font-weight: 600; }
.hi-ok { color: var(--accent3); font-weight: 600; }
.hi-val { color: var(--accent); font-family: var(--font-mono); }

/* PITCH */
.pitch-section {
  padding: 5rem 4rem;
  border-bottom: 1px solid var(--border);
}
.pitch-main {
  max-width: 720px;
  margin-bottom: 3rem;
}
.pitch-quote {
  border-left: 4px solid var(--accent);
  padding: 1.5rem 2rem;
  background: white;
  font-size: 1.05rem;
  line-height: 1.8;
  font-style: italic;
  margin-bottom: 2rem;
}
.pitch-quote strong { font-style: normal; color: var(--accent); }
.exec-row {
  display: grid; grid-template-columns: repeat(3,1fr); gap: 1.5rem;
}
.exec-card {
  border: 1px solid var(--border);
  padding: 1.5rem;
  background: white;
}
.exec-n {
  font-family: var(--font-mono);
  font-size: 0.65rem;
  color: var(--muted);
  margin-bottom: 0.6rem;
}
.exec-t { font-family: var(--font-display); font-weight: 600; font-size: 0.92rem; margin-bottom: 0.5rem; }
.exec-d { font-size: 0.82rem; color: var(--muted); font-family: var(--font-display); font-weight: 400; }
</style>
</head>
<body>

<nav>
  <a class="nav-logo" href="#top">HUF</a>
  <a href="#platforms">Platforms</a>
  <a href="#math">Math</a>
  <a href="#code">Code</a>
  <a href="#sim">Simulation</a>
  <a href="#pitch">Pitch</a>
  <div class="nav-sep"></div>
  <span class="nav-tag">EVAL · COMPOSITION AUDIT</span>
</nav>

<section class="hero" id="top">
  <div class="hero-left">
    <div class="hero-eyebrow">Partner Package · Eval Platforms · v1.1.8</div>
    <h1>Evaluation Platforms<br><strong>× HUF</strong></h1>
    <p class="hero-sub">HUF adds a composition audit layer to RAG evaluation suites — tracking source diversity, mass concentration, and coherence drift across eval runs so quality regressions are caught before deployment.</p>
  </div>
  <div class="hero-aside">
    <div class="aside-title">Package Metrics</div>
    <div class="aside-metric"><span class="label">Platform fit</span><span class="val">93%</span></div>
    <div class="aside-metric"><span class="label">C(ℋ) achieved</span><span class="val">0.928</span></div>
    <div class="aside-metric"><span class="label">Avg α*</span><span class="val">0.52</span></div>
    <div class="aside-metric"><span class="label">kb erosion</span><span class="val">−13.9%</span></div>
    <div class="aside-metric"><span class="label">items_90pct alert</span><span class="val">k &lt; 4</span></div>
    <div class="aside-metric"><span class="label">top-src alert</span><span class="val">ρ &gt; 0.65</span></div>
  </div>
</section>

<section class="platforms-section" id="platforms">
  <div class="sec-header">
    <span class="sec-num">01</span>
    <h2 class="sec-title">Supported Evaluation Platforms</h2>
  </div>
  <div class="platforms-grid">
    <div class="plat-card">
      <div class="plat-name">Ragas</div>
      <div class="plat-desc">RAG evaluation framework measuring faithfulness, answer relevancy, and context precision. HUF adds composition coherence to the metric suite.</div>
      <div class="plat-hook">on_dataset_evaluated() → HUF audit</div>
    </div>
    <div class="plat-card">
      <div class="plat-name">TruLens</div>
      <div class="plat-desc">LLM observability and evaluation platform. HUF hooks into the feedback function pipeline post-retrieval to log composition state.</div>
      <div class="plat-hook">TruChain feedback + HUF callback</div>
    </div>
    <div class="plat-card">
      <div class="plat-name">ARES</div>
      <div class="plat-desc">Automated RAG evaluation system using LLM judges. HUF augments ARES context quality checks with normalized source mass tracking.</div>
      <div class="plat-hook">context_relevance_scorer + rho</div>
    </div>
    <div class="plat-card">
      <div class="plat-name">DeepEval</div>
      <div class="plat-desc">Open-source LLM evaluation framework with custom metric support. HUF provides a HUFCoherenceMetric class for drop-in integration.</div>
      <div class="plat-hook">BaseMetric.measure() override</div>
    </div>
    <div class="plat-card">
      <div class="plat-name">PromptFlow</div>
      <div class="plat-desc">Azure ML orchestration for LLM workflows. HUF plugs into the evaluation variant pipeline as a post-retrieval node.</div>
      <div class="plat-hook">EvaluatorNode post-retrieval</div>
    </div>
    <div class="plat-card">
      <div class="plat-name">LangSmith</div>
      <div class="plat-desc">LangChain's tracing and evaluation platform. HUF writes coherence metadata directly to run traces via the evaluation API.</div>
      <div class="plat-hook">run.feedback → HUF metadata</div>
    </div>
  </div>
</section>

<section class="math-section" id="math">
  <div class="sec-header">
    <span class="sec-num">02</span>
    <h2 class="sec-title">Mathematical Foundation</h2>
  </div>
  <div class="math-row">
    <div class="math-block">
      <div class="math-label">Composition Score</div>
      <div class="math-eq">
C_comp = items_to_cover_90pct / N
<span class="cm">// N = total retrieved documents</span>
<span class="cm">// C_comp → 1.0 = perfect diversity</span>
<span class="cm">// C_comp < 0.4 = concentration risk</span>
      </div>
      <div class="math-note">A simple normalization of the concentration metric, giving evaluators a 0–1 composition score to track alongside RAGAS scores.</div>
    </div>
    <div class="math-block">
      <div class="math-label">Mass Distribution Variance</div>
      <div class="math-eq">
Var(ρ) = (1/n) Σᵢ (ρᵢ − ρ̄)²
<span class="cm">// ρ = softmax(scores)</span>
<span class="cm">// target Var < 0.02 for eval pass</span>
      </div>
      <div class="math-note">High variance indicates one or few documents dominating the context window, a hidden quality risk not captured by standard eval metrics.</div>
    </div>
    <div class="math-block full">
      <div class="math-label">Eval-Augmented Objective</div>
      <div class="math-eq">
J_eval(α) = (1 − C(ℋ)) + λ·Var(ρ) + κ·(1 − C_comp) + ε·(1 − F_answer)
<span class="cm">// F_answer = faithfulness score from eval platform (0–1)</span>
<span class="cm">// κ = 0.12  ε = 0.08</span>
<span class="cm">// Bridges HUF coherence with standard RAG quality metrics</span>
      </div>
      <div class="math-note">The combined objective links HUF's structural composition audit with the answer-quality signal from evaluation platforms. Low faithfulness (F_answer) tightens the damping penalty on source concentration.</div>
    </div>
  </div>
</section>

<section class="code-section" id="code">
  <div class="sec-header">
    <span class="sec-num">03</span>
    <h2 class="sec-title">Integration Code</h2>
  </div>
  <div class="code-wrap">
    <div class="code-header">
      <div class="code-dot" style="background:#ff5f57"></div>
      <div class="code-dot" style="background:#febc2e"></div>
      <div class="code-dot" style="background:#28c840"></div>
      <span class="code-filename">huf_eval_metric.py</span>
    </div>
    <pre><span class="kw">from</span> deepeval.metrics <span class="kw">import</span> BaseMetric
<span class="kw">from</span> deepeval.test_case <span class="kw">import</span> LLMTestCase
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">from</span> scipy.special <span class="kw">import</span> softmax
<span class="kw">import</span> json, datetime, pathlib

<span class="kw">class</span> <span class="fn">HUFCompositionMetric</span>(BaseMetric):
    <span class="st">"""HUF composition audit as a DeepEval metric.
    Compatible with Ragas, TruLens, ARES via adapter shim.
    """</span>

    name = <span class="st">"huf_composition"</span>
    threshold = <span class="nu">0.60</span>   <span class="cm"># min C_comp to pass</span>

    <span class="kw">def</span> <span class="fn">__init__</span>(self, jsonl_path=<span class="st">"huf_eval_log.jsonl"</span>,
                 alert_k=<span class="nu">4</span>, alert_var=<span class="nu">0.02</span>):
        self.jsonl_path = pathlib.Path(jsonl_path)
        self.alert_k = alert_k
        self.alert_var = alert_var
        self.score = <span class="nu">None</span>
        self.reason = <span class="st">""</span>

    <span class="kw">def</span> <span class="fn">measure</span>(self, test_case: LLMTestCase):
        docs = test_case.retrieval_context <span class="kw">or</span> []
        scores_raw = getattr(test_case, <span class="st">"retrieval_scores"</span>, <span class="nu">None</span>)

        <span class="cm"># Build score vector</span>
        <span class="kw">if</span> scores_raw <span class="kw">and</span> len(scores_raw) == len(docs):
            s = np.array([float(x) <span class="kw">for</span> x <span class="kw">in</span> scores_raw])
        <span class="kw">else</span>:
            s = np.array([<span class="nu">1.0</span> / (i+<span class="nu">1</span>) <span class="kw">for</span> i <span class="kw">in</span> range(len(docs))])

        rho = softmax(s)
        var = float(np.var(rho))

        <span class="cm"># items_to_cover_90pct</span>
        sorted_r = sorted(rho, reverse=True)
        k, cs = <span class="nu">0</span>, <span class="nu">0.0</span>
        <span class="kw">for</span> r <span class="kw">in</span> sorted_r:
            cs += r; k += <span class="nu">1</span>
            <span class="kw">if</span> cs >= <span class="nu">0.9</span>: <span class="kw">break</span>

        c_comp = k / max(len(docs), <span class="nu">1</span>)
        self.score = round(c_comp, <span class="nu">4</span>)
        self.success = c_comp >= self.threshold

        alert = k < self.alert_k <span class="kw">or</span> var > self.alert_var
        self.reason = (
            <span class="fn">f"items_to_cover_90pct={k}, Var={var:.4f}, C_comp={c_comp:.4f}, "
            f"alert={'YES' if alert else 'NO'}"</span>
        )

        record = {
            <span class="st">"ts"</span>: datetime.datetime.utcnow().isoformat(),
            <span class="st">"test_id"</span>: getattr(test_case, <span class="st">"id"</span>, <span class="st">"unknown"</span>),
            <span class="st">"n_docs"</span>: len(docs),
            <span class="st">"items_to_cover_90pct"</span>: k,
            <span class="st">"c_comp"</span>: self.score,
            <span class="st">"var_rho"</span>: round(var, <span class="nu">5</span>),
            <span class="st">"alert"</span>: alert,
            <span class="st">"pass"</span>: self.success,
        }
        <span class="kw">with</span> self.jsonl_path.open(<span class="st">"a"</span>) <span class="kw">as</span> f:
            f.write(json.dumps(record) + <span class="st">"\n"</span>)

        <span class="kw">return</span> self.score

<span class="cm"># --- Usage with DeepEval ---</span>
<span class="kw">from</span> deepeval <span class="kw">import</span> evaluate

huf = <span class="fn">HUFCompositionMetric</span>()
test_cases = [...]   <span class="cm"># your LLMTestCase list</span>
evaluate(test_cases, metrics=[huf])
print(<span class="fn">f"HUF composition pass rate: {huf.score:.3f}"</span>)</pre>
  </div>
</section>

<section class="sim-section" id="sim">
  <div class="sec-header">
    <span class="sec-num">04</span>
    <h2 class="sec-title">10-Run Eval Simulation</h2>
  </div>
  <div style="overflow-x:auto">
    <table class="sim-table">
      <thead>
        <tr>
          <th>Run</th>
          <th>α*</th>
          <th>C_comp</th>
          <th>Var(ρ)</th>
          <th>items_90pct</th>
          <th>Faithfulness</th>
          <th>J_eval</th>
          <th>Pass</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>0</td><td>—</td><td><span class="hi-val">0.600</span></td><td>0.0180</td><td>6</td><td>0.88</td><td>—</td><td class="hi-ok">✓</td></tr>
        <tr><td>1</td><td>0.51</td><td><span class="hi-val">0.607</span></td><td>0.0175</td><td>6</td><td>0.89</td><td>0.118</td><td class="hi-ok">✓</td></tr>
        <tr><td>2</td><td>0.52</td><td><span class="hi-val">0.615</span></td><td>0.0170</td><td>6</td><td>0.89</td><td>0.114</td><td class="hi-ok">✓</td></tr>
        <tr><td>3</td><td>0.51</td><td><span class="hi-val">0.590</span></td><td>0.0195</td><td>5</td><td>0.87</td><td>0.122</td><td class="hi-ok">✓</td></tr>
        <tr><td>4 ⚡</td><td>0.47</td><td><span class="hi-alert">0.300</span></td><td><span class="hi-alert">0.0420</span></td><td class="hi-alert">3</td><td>0.79</td><td>0.198</td><td class="hi-alert">✗ ALERT</td></tr>
        <tr><td>5*</td><td>0.56</td><td><span class="hi-val">0.640</span></td><td>0.0155</td><td>6</td><td>0.91</td><td>0.108</td><td class="hi-ok">✓</td></tr>
        <tr><td>6</td><td>0.53</td><td><span class="hi-val">0.650</span></td><td>0.0148</td><td>6</td><td>0.91</td><td>0.105</td><td class="hi-ok">✓</td></tr>
        <tr><td>7</td><td>0.52</td><td><span class="hi-val">0.658</span></td><td>0.0144</td><td>7</td><td>0.92</td><td>0.102</td><td class="hi-ok">✓</td></tr>
        <tr><td>8</td><td>0.53</td><td><span class="hi-val">0.660</span></td><td>0.0142</td><td>7</td><td>0.92</td><td>0.101</td><td class="hi-ok">✓</td></tr>
        <tr><td>9</td><td>0.53</td><td><span class="hi-val">0.665</span></td><td>0.0140</td><td>7</td><td>0.93</td><td>0.099</td><td class="hi-ok">✓</td></tr>
        <tr><td>10</td><td>0.54</td><td><span class="hi-val">0.670</span></td><td>0.0138</td><td>7</td><td>0.93</td><td>0.098</td><td class="hi-ok">✓</td></tr>
      </tbody>
    </table>
  </div>
  <p style="font-size: 0.8rem; color: var(--muted); margin-top: 1rem; font-family: var(--font-display);">* Run 5: re-normalization after concentration event. ⚡ = context window dominated by single namespace. Faithfulness correlation with C_comp: r = 0.81.</p>
</section>

<section class="pitch-section" id="pitch">
  <div class="sec-header">
    <span class="sec-num">05</span>
    <h2 class="sec-title">Partnership Pitch &amp; Execution</h2>
  </div>
  <div class="pitch-main">
    <blockquote class="pitch-quote">
      HUF adds a <strong>composition audit layer</strong> that existing eval platforms are missing — tracking not just answer quality but the <strong>source mass distribution</strong> that produced it. When a single namespace dominates (&gt;65% mass), faithfulness scores drop and users don't know why. HUF catches this with items_to_cover_90pct as a headline metric, logging JSONL artifacts for every eval run and reducing kb mass erosion by <strong>13.9%</strong> across 10 simulated evaluation cycles.
    </blockquote>
  </div>
  <div class="exec-row">
    <div class="exec-card">
      <div class="exec-n">Step 01</div>
      <div class="exec-t">Submit Plugin / Metric</div>
      <div class="exec-d">Submit HUFCompositionMetric as a PR to DeepEval and an integration guide to the Ragas docs. Both accept community metric contributions.</div>
    </div>
    <div class="exec-card">
      <div class="exec-n">Step 02</div>
      <div class="exec-t">Slack + GitHub</div>
      <div class="exec-d">Post demo in DeepEval Discord, TruLens Slack #integrations, and Ragas GitHub Discussions showing the correlation between C_comp and faithfulness score.</div>
    </div>
    <div class="exec-card">
      <div class="exec-n">Step 03</div>
      <div class="exec-t">Blog Collab</div>
      <div class="exec-d">Co-author a "Hidden RAG quality risks" post with Ragas or DeepEval team showing composition score as a missing dimension in standard eval suites.</div>
    </div>
  </div>
</section>

</body>
</html>
